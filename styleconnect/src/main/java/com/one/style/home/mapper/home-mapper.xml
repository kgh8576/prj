<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.one.style.home.mapper.HomeServiceMap">

	<!-- 메인에서 평점 순 top3 디자이너 가져오기 -->
	<select id="ajaxTopDesInfo" parameterType="string" resultType="com.one.style.home.vo.HomeVO">
	  select id, name, major, trunc(rate) as rate, f.FILE_UUID
	  from FILES f,
	    (select id, name, major, avg(rate) as rate
	    from designer d, review r
	    where d.id = r.des_id
	    <if test="keyword == 'cut'">
	    and cut_yn = 'Y'
	    </if>
	    <if test="keyword == 'perm'">
	    and perm_yn = 'Y'
	    </if>
	    <if test="keyword == 'dye'">
	    and dye_yn = 'Y'
	    </if>
	    <if test="keyword == 'makeUp'">
	    and makeup_yn = 'Y'
	    </if>
	    group by id, name, major
	    order by 4 desc) inSq
	  where rownum between 1 and 3
	  and f.DES_ID(+) = id
	  and f.FILE_STATE = 'pro'
	</select>
	
	<!-- 전체 후기 건수 가져오기 -->
	<select id="ajaxTopDesCount" parameterType="string" resultType="com.one.style.home.vo.HomeVO">	
		select des_id, count(*) as count
		from review
		where des_id in
		  (select id
		  from
		    (select id, name, trunc(rate) as rate from
		      (select id, name, avg(rate) as rate
		      from review r, designer d
		      where r.des_id = d.id
		      <if test="keyword == 'perm'">
		      and PERM_YN = 'Y'
		      </if>
		  	  <if test="keyword == 'cut'">
			  and cut_yn = 'Y'	  
			  </if>
			  <if test="keyword == 'dye'">
			  and dye_yn = 'Y'
			  </if>
			  <if test="keyword == 'makeUp'">
			  and makeup_yn = 'Y'
			  </if>
		      group by id, name
		      order by 3 desc)
		    where rownum between 1 and 3))
		group by des_id
	
	</select>
	
	
	<select id="memDetail" parameterType="String" resultType="com.one.style.mem.vo.MemDetailVO">
		select m.id, name, gender, location, md.MAKEUP_YN, md.CUT_YN, md.PERM_YN, md.DYE_YN
		from mem_detail md, member m
		where md.id = m.id
		and m.id = #{id}
	</select>
	
	<select id="rcmdDesByConHis" parameterType="com.one.style.home.vo.HomeVO" resultType="com.one.style.home.vo.HomeVO">
		
	</select>
	
	<select id="rcmdDesByRate" parameterType="com.one.style.home.vo.HomeVO" resultType="com.one.style.home.vo.HomeVO">
	</select>
</mapper>